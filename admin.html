<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ButDAO - 관리자</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" href="/assets/img/favicon.png">
  <link rel="shortcut icon" href="/assets/img/favicon.png">

  <link rel="stylesheet" href="/assets/css/style.css" />

  <style>
    /* 모바일에서 깨지는 것 방지 + 버튼 흰색 */
    .btn, button, input[type="button"], input[type="submit"]{
      background:#fff !important;
      color:#000 !important;
      border:0 !important;
      border-radius:12px !important;
      padding:10px 14px !important;
      font-weight:700 !important;
      cursor:pointer;
    }
    .btn:disabled, button:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .msgbox{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      color:#ddd;
      white-space:pre-wrap;
      word-break:break-word;
      overflow-wrap:anywhere;
      max-width:100%;
    }
    .grid2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width: 820px){
      .grid2{ grid-template-columns:1fr; }
    }
    .card{
      border-radius:18px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
      padding:14px;
    }
    .field{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.25);
      color:#fff;
      outline:none;
    }
    textarea.field{ min-height:120px; resize:vertical; }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .muted{ color:#aeb6c2; font-size:13px; }
    .title{ font-size:20px; font-weight:800; margin-bottom:6px; }
    .subtitle{ color:#aeb6c2; font-size:13px; line-height:1.45; margin-bottom:12px; }
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    .item{
      border-radius:14px;
      background:rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.08);
      padding:12px;
    }
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.12);
      color:#fff;
      font-size:12px;
      margin-left:8px;
    }
  </style>
</head>
<body>

  <div id="include-head"></div>

  <main class="page" style="max-width:1100px;margin:0 auto;padding:18px 14px;">
    <div class="title">관리자</div>
    <div class="subtitle">
      staff 레벨이 5 이상이면 심사(pending) 목록을 자동으로 불러옵니다.<br/>
      pendingAt(uint256) 호출 전 staff 레벨과 pendingLen을 먼저 확인해서 revert를 방지합니다.
    </div>

    <div class="grid2">
      <section class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-weight:800;">미션 단가 등록</div>
            <div class="muted">setAdPrice(missionId, price) 호출</div>
          </div>
          <div class="muted" id="staffInfo">staff: -</div>
        </div>

        <div style="height:10px;"></div>

        <div class="grid2">
          <div>
            <div class="muted" style="margin-bottom:6px;">missionId</div>
            <input id="missionId" class="field" placeholder="예: 1" />
          </div>
          <div>
            <div class="muted" style="margin-bottom:6px;">price (HEX, 18dec)</div>
            <input id="missionPrice" class="field" placeholder="예: 2.5" />
          </div>
        </div>

        <div style="height:12px;"></div>

        <div class="row">
          <button id="btnSetPrice">저장</button>
          <div class="muted" id="curPrice">현재 단가: -</div>
        </div>

        <div id="msgPrice" class="msgbox"></div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-weight:800;">심사중 요청 목록</div>
            <div class="muted">pendingLen → pendingAt(i) 로 목록 조회</div>
          </div>
          <div class="row">
            <button id="btnRefresh">새로고침</button>
          </div>
        </div>

        <div class="muted" style="margin-top:8px;">
          approveClaim(id, missionId) / rejectClaim(id, missionId)
        </div>

        <div class="list" id="pendingList">
          <div class="item muted">목록을 불러오는 중...</div>
        </div>

        <div id="msgPending" class="msgbox"></div>
      </section>

      <!-- 신규: 미션 가이드(광고주 요구) -->
      <section class="card" style="margin-top:14px;">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="title">미션 가이드 관리</div>
            <div class="muted">광고주가 원하는 요구사항을 missionId별로 저장 (Firestore)</div>
          </div>
          <div class="muted" id="guideStatus">-</div>
        </div>

        <div style="height:10px;"></div>

        <div class="muted" style="margin-bottom:6px;">가이드 내용</div>
        <textarea id="missionGuide" class="field" placeholder="예: 키워드 포함, 이미지 3장 이상, 글자수 800자 이상, 링크 삽입 등"></textarea>

        <div style="height:12px;"></div>

        <div class="row">
          <button id="btnGuideLoad">불러오기</button>
          <button id="btnGuideSave">저장</button>
        </div>

        <div id="msgGuide" class="msgbox"></div>
      </section>

      <!-- 기존: 광고 주문 현황 -->
      <section class="card" style="margin-top:14px;">
        <div class="row" style="justify-content:space-between; align-items:center;">
          <div>
            <div class="title">광고 주문 현황</div>
            <div class="sub">결제 영수증(opbnbscan) 포함</div>
          </div>
          <div class="row" style="gap:8px;">
            <button class="btn ghost" id="btnOrdersRefresh">새로고침</button>
            <select id="ordersLimit" style="height:38px;">
              <option value="20">20개</option>
              <option value="50" selected>50개</option>
              <option value="100">100개</option>
            </select>
          </div>
        </div>

        <div class="hr"></div>

        <div id="ordersMsg" class="muted"></div>
        <div id="ordersList" class="list" style="margin-top:10px;"></div>
      </section>
    </div>
  </main>

  <div id="include-footer"></div>

  <!-- Firebase compat: admin.js가 Firestore를 사용 -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="/assets/js/config.js"></script>
  <script src="/assets/js/include.js"></script>
  <script src="/assets/js/wallet.js"></script>

  <!-- 기존 admin.js 하나로 통합 -->
  <script src="/assets/js/admin.js"></script>

  <!-- admin_orders.js는 중복/권한 에러 유발 가능: 제거 -->
  <!-- <script type="module" src="/assets/js/admin_orders.js"></script> -->
</body>
</html>
